name: Documentation

on:
  push:
    branches: [main]
    paths:
      - '**/*.go'
      - '**/*.md'
  pull_request:
    branches: [main]
    paths:
      - '**/*.go'
      - '**/*.md'
  workflow_dispatch:

jobs:
  terraform-docs:
    name: Validate Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.ref }}

      - name: Render terraform docs
        uses: terraform-docs/gh-actions@v1.0.0
        with:
          working-dir: examples
          output-file: README.md
          output-method: inject
          git-push: "true"
          git-commit-message: "docs: Update generated terraform docs"

  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Run markdownlint
        uses: DavidAnson/markdownlint-cli2-action@v13
        with:
          globs: |
            **/*.md
            !node_modules/**